---
title: "U-LeNet. Files with MPs characteristics"
subtitle: "Code for cleaning and merging data for seven convocations 1998-2019"
author: 'Oleksa Stepaniuk'
date: "`r Sys.setlocale('LC_TIME', 'C'); format(Sys.time(), '%d %B, %Y')`"
output:
  pdf_document:
    number_sections: TRUE
header-includes:
  \usepackage[ukrainian]{babel}
  \renewcommand\rmdefault{cmr} 
  \renewcommand\sfdefault{cmss}
---

<!-- markdown's bold and italic stop working after including babel package -->
<!-- https://tex.stackexchange.com/questions/246830/markdowns-bold-and-italic-stop-working-after-including-babel-package -->



```{r setup, include=FALSE}
library(dplyr)
library(stringr) #to manipulate strings

Sys.setlocale("LC_TIME", "C")

directory_working <- "C:/Users/Oleksa/Documents/Projects/Rada_networks"
directory_data <- "./data_8"
directory_mps <- "./MPS"

knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = directory_working)
```


## Vectors with special cases for Rada 3
```{r}
# most observations had a missing faction values. Added them from the rada website.
# for the 3rd Rada there is no infprmation on switching the factions, so if MP prematurely stopped
# being an MP he or she is indicated as Non-affiliated

# two MPs had two records per person with a slight variation of the name spelling:
# Жовтіс Олександр Ігорович, Жовтіс Олександр Ігоревич
# Коломойцев-Рибалка Валерій Едуардович, Коломойцев Валерій Едуардович
# in both cases we kept the first version of spelling

rada_management_3 <- c('Ткаченко Олександр Миколайович', 'Плющ Іван Степанович',
                       'Мартинюк Адам Іванович', 'Медведчук Віктор Володимирович',
                       'Гавриш Степан Богданович')
```



## Vectors with special cases for Rada 4
```{r}
# Database does not have party affiliation
# I added the party that put forward an MP. This may be different from membership in a party
# For MPs selected via party system I added party using the Rada website, for the constituency
# MPs I used a table from the Wiki
# https://uk.wikipedia.org/wiki/%D0%92%D0%B5%D1%80%D1%85%D0%BE%D0%B2%D0%BD%D0%B0_%D0%A0%D0%B0%D0%B4%D0%B0_%D0%A3%D0%BA%D1%80%D0%B0%D1%97%D0%BD%D0%B8_IV_%D1%81%D0%BA%D0%BB%D0%B8%D0%BA%D0%B0%D0%BD%D0%BD%D1%8F
# As previous checked all the non-affiliated MPs and added the faction to those that stopped being MPs
# prematurely


rada_management_4 <- c('Литвин Володимир Михайлович',
                       'Васильєв Геннадій Андрійович', 'Мартинюк Адам Іванович',
                       'Зінченко Олександр Олексійович')


group_head_4 <- c('Шаров Ігор Федорович')
group_representative_4 <- c('Нощенко Микола Петрович')
faction_representatives_4 <- c("Асадчев Валерій Михайлович",  "Беспалий Борис Якович",  
                                     "Богатирьова Раїса Василівна",  "Бокий Іван Сидорович",  
                                     "Бондаренко Володимир Дмитрович",  "Ващук Катерина Тимофіївна",  
                                     "Веретенников Віктор Олександрович",  "Вінський Йосип Вікентійович",  
                                     "Гаврилюк Василь Васильович",  "Гавриш Степан Богданович",  
                                     "Грязєв Анатолій Дмитрович",  "Гудима Олександр Миколайович",  
                                     "Гуреєв Василь Миколайович",  "Довгий Станіслав Олексійович",  
                                     "Заєць Володимир Володимирович",  "Заєць Іван Олександрович",  
                                     "Заплатинський Володимир Михайлович",  "Зубов Валентин Сергійович",  
                                     "Калінчук Василь Антонович",  
                                     "Касьянов Сергій Павлович",  "Кендзьор Ярослав Михайлович",  
                                     "Кирильчук Євген Іванович",  "Клімов Леонід Михайлович",  
                                     "Коновалюк Валерій Ілліч",  "Косів Михайло Васильович",  
                                     "Костинюк Богдан Іванович",  "Ларін Сергій Миколайович",  
                                     "Майко Віталій Іванович",  "Мартиновський Валерій Павлович",  
                                     "Матвєєв Валентин Григорович",  "Мельничук Михайло Васильович",  
                                     "Надрага Василь Іванович",  "Наконечний Володимир Леонтієвич",  
                                     "Одайник Микола Миколайович",  "Оніщук Микола Васильович",  
                                     "Осташ Ігор Іванович",  "Пєхота Володимир Юлійович",  
                                     "Поживанов Михайло Олександрович",  "Пономаренко Георгій Григорович",  
                                     "Поровський Микола Іванович",  "Потапов Василь Іванович",  
                                     "Рішняк Іван Миколайович",  "Рудьковський Микола Миколайович",  
                                     "Самофалов Геннадій Григорович",  "Семинога Анатолій Іванович",  
                                     "Слабенко Сергій Іванович",  "Танюк Леонід Степанович",  
                                     "Таран-Терен Віктор Васильович",  "Терещук Сергій Миколайович",  
                                     "Удовенко Геннадій Йосипович",  "Філенко Володимир Пилипович",  
                                     "Франчук Анатолій Романович",  "Царьов Олег Анатолійович",  
                                     "Цибенко Петро Степанович",  "Чорноволенко Олександр Віленович",  
                                     "Чубаров Рефат Абдурахманович",  "Шевчук Сергій Володимирович",  
                                     "Шепетін Володимир Леонідович",  "Шкіль Андрій Васильович",  
                                     "Шурма Ігор Михайлович",  "Шуфрич Нестор Іванович")
```


## Vectors with special cases for Rada 5
```{r}
# All MPs were elected via party system
# All MPs belonged to a party and to the faction with the same name as a party
# There were no cases of MP changing the faction
# Convocation was prematurely terminated by president due to problems with forming a coalition 


rada_management_5 <- c('Мороз Олександр Олександрович', 'Мартинюк Адам Іванович',
                       'Томенко Микола Володимирович')

government_5 <- c('Янукович Віктор Федорович', 'Азаров Микола Янович', 'Клюєв Андрій Петрович',
                  'Табачник Дмитро Володимирович', 'Кузьмук Олександр Іванович',
                  'Рибак Володимир Васильович', 'Слаута Віктор Андрійович', "Мельник Юрій Федорович",
                  "Цушко Василь Петрович", "Тулуб Сергій Борисович", "Кінах Анатолій Кирилович",
                  "Попов Олександр Павлович", "Яценюк Арсеній Петрович", "Богуцький Юрій Петрович",
                  "Шуфрич Нестор Іванович", "Гриценко Анатолій Степанович",
                  "Ніколаєнко Станіслав Миколайович", "Поляченко Юрій Володимирович",
                  "Гайдаєв Юрій Олександрович", "Джарти Василь Георгійович", "Бойко Юрій Анатолійович",
                  "Папієв Михайло Миколайович", "Головко Анатолій Іванович", "Яцуба Володимир Григорович", 
                  "Корж Віктор Петрович", "Рудьковський Микола Миколайович", 
                  "Лавринович Олександр Володимирович", "Ткаленко Іван Іванович", 
                  "Толстоухов Анатолій Володимирович")

faction_heads_5 <- c('Богатирьова Раїса Василівна', 'Бокий Іван Сидорович', 'Замковенко Микола Іванович',
                     "Кириленко В'ячеслав Анатолійович", 'Симоненко Петро Миколайович',
                     'Тимошенко Юлія Володимирівна', 'Янукович Віктор Федорович')

```


## Vectors with special cases for Rada 6
```{r}
government_6 <- c('Азаров Микола Янович', 'Акімова Ірина Михайлівна', 'Бабаєв Олег  Мейданович',
                  'Богатирьова Раїса Василівна',  'Бойко Юрій Анатолійович', 'Боярчук Олексій Валерійович',
                  'Бурлаков Павло Миколайович', 'Буряк Сергій Васильович', 'Вілкул Олександр Юрійович',
                  'Вінський Йосип Вікентійович', 'Герман Ганна Миколаївна', 'Демішкан Володимир Федорович',
                  'Джарти Василь Георгійович', 'Джига Микола Васильович', 'Єхануров Юрій Іванович',
                  'Зарудний Олексій Борисович', 'Злочевський Микола Владиславович',
                  'Ілляшов Григорій Олексійович', 'Калєтнік Ігор Григорович',
                  'Каськів Владислав Володимирович', 'Клюєв Андрій Петрович', 'Козак Володимир Васильович',
                  'Колесніков Борис Вікторович', 'Колєсніков Дмитро Валерійович',
                  'Корнійчук Євген Володимирович', 'Костусєв Олексій Олексійович',
                  'Кравець Андрій Віталійович', 'Кравчук Петро Костянтинович',
                  'Круглов Микола Петрович', 'Крупко Петро Миколайович',
                  'Куйбіда Василь Степанович', 'Кучеренко Олексій Юрійович',
                  'Лавринович Олександр Володимирович', 'Ларін Сергій Миколайович')

rada_management_6 <- c('Яценюк Арсеній Петрович', 'Литвин Володимир Михайлович',
                       'Лавринович Олександр Володимирович',
                       'Мартинюк Адам Іванович', 'Томенко Микола Володимирович')

faction_heads_6 <- c('Єфремов Олександр Сергійович', "Кожем'якін Андрій Анатолійович",
                     'Мартиненко Микола Володимирович', 'Симоненко Петро Миколайович',
                     'Шаров Ігор Федорович')

group_heads_6 <- c('Рибаков Ігор Олександрович')
```



## Vectors with special cases for Rada 7
```{r}
government_7 <- c('Аверченко Сергій Миколайович', 'Аваков Арсен Борисович',
                  'Бурбак Максим Юрійович', 'Ванзуряк Роман Степанович',
                  'Денісова Людмила Леонтіївна', 'Кличко Віталій Володимирович',
                  'Кожара Леонід Олександрович', 'Лавринович Олександр Володимирович',
                  'Лебедєв Павло Валентинович', 'Махніцький Олег Ігорович',
                  'Мохник Андрій Володимирович', 'Наливайченко Валентин Олександрович',
                  'Парубій Андрій Володимирович', 'Петренко Павло Дмитрович',
                  'Прасолов Ігор Миколайович', 'Сас Сергій Володимирович',
                  'Сиротюк Олег Мирославович', 'Сич Олександр Максимович',
                  'Слюз Тетяна Ярославівна', 'Табачник Дмитро Володимирович',
                  'Черняков Валерій Вікторович', 'Швайка Ігор Олександрович',
                  'Ярема Віталій Григорович', 'Яценюк Арсеній Петрович')

rada_management_7 <- c('Рибак Володимир Васильович', 'Турчинов Олександр Валентинович',
                       'Калєтнік Ігор Григорович', 'Кошулинський Руслан Володимирович')

faction_heads_7 <- c('Єфремов Олександр Сергійович', 'Яценюк Арсеній Петрович',
                     'Соболєв Сергій Владиславович', 'Кличко Віталій Володимирович',
                     'Ковальчук Віталій Анатолійович', 'Тягнибок Олег Ярославович',
                     'Симоненко Петро Миколайович')

group_heads_7 <- c('Кінах Анатолій Кирилович')

group_representatives_7 <- c('Єремеєв Ігор Миронович', 'Москаленко Ярослав Миколайович',
                             'Доній Олександр Сергійович',
                             'Козуб Олександр Андрійович', 'Балицький Євген Віталійович',
                             'Присяжнюк Олександр Андрійович')

```


## Vectors with special cases for Rada 8
```{r}
# when MPS terminate their service their stop being members of faction/group
# as a result they are denoted as non-affiliated even when they previously belonged to faction/group

# in cases when MP left or changed faction we indicated the latest affiliation in a given convocation

# when MP joined rada management we indicated his previous faction

# Павленко Ростислав Миколайович став заступником голови Адміністрації Президента
# includes government, presidents administration, RNBO, chief state prosecutor, 1st deputy of state prosecutor
# head of region administration
government_8 <- c('Вощевський Валерій Миколайович',
                'Петренко Павло Дмитрович', 'Аваков Арсен Борисович',
                'Квіт Сергій Миронович', "Кириленко В'ячеслав Анатолійович",
                'Ковальчук Віталій Анатолійович', 'Павленко Ростислав Миколайович',
                'Розенко Павло Валерійович',
                'Стець Юрій Ярославович',
                'Турчинов Олександр Валентинович',
                'Гриневич Лілія Михайлівна', 'Гройсман Володимир Борисович',
                'Климпуш-Цинцадзе Іванна Орестівна', 'Кубів Степан Іванович',
                'Кутовий Тарас Вікторович', 'Луценко Юрій Віталійович',
                'Семерак Остап Михайлович', 'Сторожук Дмитро Анатолійович', 'Куліч Валерій Петрович',
                'Яценюк Арсеній Петрович')

institutions <- c('Президент України', 'Кабінет Міністрів України')


rada_management_8 <- c('Гройсман Володимир Борисович','Парубій Андрій Володимирович',
                     'Геращенко Ірина Володимирівна',
                     'Сироїд Оксана Іванівна')

faction_peoples_will_8 <- c('Єремеєв Ігор Миронович', 'Микитась Максим Вікторович',
                          'Шахов Сергій Володимирович', 'Супруненко Олександр Іванович')


# Мірошник Андрій Миколайович stopped being an MP because of a scandal
faction_samopomich_8 <- c('Мірошник Андрій Миколайович')

  
faction_non_affiliated_8 <- c('Атрошенко Владислав Анатолійович', 'Барна Степан Степанович',
                            'Констанкевич Ірина Мирославівна', 'Шевченко Віктор Леонідович')


# Мартиненко Микола Володимирович stopped being an MP because of the corruption scandal
# Гриневич Лілія Михайлівна became a minister but was an MP for more than a year
faction_peoples_front_8 <- c('Бендюженко Федір Володимирович', 'Данілін Владислав Юрійович',
                           'Мартиненко Микола Володимирович', 'Гриневич Лілія Михайлівна',
                           'Петренко Павло Дмитрович', 'Аваков Арсен Борисович',
                           "Кириленко В'ячеслав Анатолійович", 'Турчинов Олександр Валентинович',
                           'Семерак Остап Михайлович', 'Сторожук Дмитро Анатолійович',
                           'Яценюк Арсеній Петрович')

# Куліч Валерій Петрович став головою Чернігівської ОДА
# Томенко and Фірсов were expelled
faction_poroshenko_8 <- c('Буглак Юрій Олександрович', 'Гвоздьов Михайло Олексійович',
                        'Куліч Валерій Петрович', 'Насіров Роман Михайлович',
                        'Ричкова Тетяна Борисівна', 'Гарбуз Юрій Григорійович',
                        'Гордєєв Андрій Анатолійович', 'Квіт Сергій Миронович',
                        'Ковальчук Віталій Анатолійович', 'Павленко Ростислав Миколайович',
                        'Розенко Павло Валерійович', 'Стець Юрій Ярославович',
                        'Климпуш-Цинцадзе Іванна Орестівна', 'Кубів Степан Іванович',
                        'Кутовий Тарас Вікторович', 'Луценко Юрій Віталійович',
                        'Насалик Ігор Степанович', 'Томенко Микола Володимирович', 'Фірсов Єгор Павлович')

# Бордюг Інна Леонідівна == Огнєвіч Злата Леонідівна
faction_radical_8 <- c('Огнєвіч Злата Леонідівна', 'Бордюг Інна Леонідівна', 'Вощевський Валерій Миколайович')

faction_opposition_block_8 <- c('Мураєв Євгеній Володимирович')

group_resurection_8 <- c('Развадовський Віктор Йосипович', 'Шаповалов Юрій Анатолійович')

faction_heads_8 <- c('Герасимов Артур Володимирович', 'Бурбак Максим Юрійович',
                   'Новинський Вадим Владиславович', 'Березюк Олег Романович',
                   'Ляшко Олег Валерійович', 'Тимошенко Юлія Володимирівна')
  
group_heads_8 <- c('Єремеєв Ігор Миронович', 'Москаленко Ярослав Миколайович')
group_co_heads_8 <- c('Бондар Віктор Васильович', 'Хомутиннік Віталій Юрійович')

```


## Levels and codes for Rada 9
```{r}
mps_codes <- read.csv('./MPS/mps_9_codes.csv', sep=";", header=TRUE, encoding = "UTF-8")

col_with_codes <- c('faction', 'faction_position', 'committee', 'committee_position',
                    'gender', 'type_elect', 'int_post', 'int_organization', 'party_id', 'region_id')

for (col in col_with_codes){
  col_name <- paste('codes_', col, sep='')
  # print(col_name)
  
  # create a vector
  assign(col_name, as.character(mps_codes[mps_codes$column==col, "short_name"]))
  
  # assign names to values
  names <- mps_codes[mps_codes$column==col, "code"]
  eval(substitute(names(x)<-names, list(x=as.symbol(col_name))))
  
  rm(col_name, col, names)
}
```


## Vectors with special cases for Rada 9
```{r}

government_9 <- c("Новосад Ганна Ігорівна", "Федоров Михайло Альбертович", 
                "Оржель Олексій Анатолійович", "Коваленко Анна Миколаївна",
                "Криклій Владислав Артурович", "Малюська Денис Леонтійович",
                'Кучер Олексій Володимирович', 'Коваленко Анна Миколаївна')

rada_management_9 <- c("Стефанчук Руслан Олексійович", "Разумков Дмитро Олександрович",
                     "Кондратюк Олена Костянтинівна")


faction_trust_9 <- c("Арешонков Володимир Юрійович", "Бабенко Микола Вікторович", "Бакунець Павло Андрійович",
  "Вельможний Сергій Анатолійович", "Горват Роберт Іванович", "Давиденко Валерій Миколайович",
  "Єфімов Максим Вікторович", "Іванчук Андрій Володимирович", "Кіт Андрій Богданович",
  "Ковальов Олександр Іванович", "Кулініч Олег Іванович", "Лунченко Валерій Валерійович",
  "Люшняк Микола Володимирович", "Петьовка Василь Васильович", "Приходько Борис Вікторович",
  "Сухов Олександр Сергійович", "Шахов Сергій Володимирович")


faction_sluha_9 <- c("Арахамія Давид Георгійович", "Новосад Ганна Ігорівна",
                     "Федоров Михайло Альбертович", 
                     "Оржель Олексій Анатолійович", "Коваленко Анна Миколаївна",
                     "Криклій Владислав Артурович", "Малюська Денис Леонтійович")
  
  # Іванісов Роман Валерійович is not a Servant
  # Поляков Антон Едуардович is not a Servant
  # Скороход Анна Костянтинівна is not a Servant
  # Рудик Сергій Ярославович is not in a database (because was elected later?)
faction_non_affiliated_9 <- c("Гриб Вікторія Олександрівна", "Деркач Андрій Леонідович",
                              "Довгий Олесь Станіславович", "Іванісов Роман Валерійович",
                              "Лабазюк Сергій Петрович", "Магера Сергій Васильович",
                              "Магомедов Муса Сергоєвич", "Молоток Ігор Федорович",
                              "Новинський Вадим Владиславович", "Поляков Антон Едуардович",
                              "Савчук Оксана Василівна", "Скороход Анна Костянтинівна",
                              "Требушкін Руслан Валерійович",
                              "Шенцев Дмитро Олексійович", "Шпенов Дмитро Юрійович",
                              "Яковенко Євген Геннадійович")

faction_voice_9 <- c("Рахманін Сергій Іванович")

faction_batkivshchyna_9 <- c("Тимошенко Юлія Володимирівна")


faction_heads_9 <- c("Арахамія Давид Георгійович", "Тимошенко Юлія Володимирівна",
                   "Рахманін Сергій Іванович")
  
group_head_9 <- c("Кулініч Олег Іванович")



no_committee_leftover_9 <- c('Derkach Andrii Leonidovych', 'Mahera Serhii Vasylovych',
                           'Mahomedov Musa Serhoievych', 'Stefanchuk Ruslan Oleksiiovych', 
                           'Trebushkin Ruslan Valeriiovych', 'Shentsev Dmytro Oleksiiovych',
                           'Yakovenko Yevhen Hennadiiovych', 'Kopylenko Oleksandr Liubymovych', 
                           'Ivanchuk Andrii Volodymyrovych', 'Razumkov Dmytro Oleksandrovych', 
                           'Kondratiuk Olena Kostiantynivna')

```



## List of files with MPs characteristics
```{r}
file_names <-  c("./MPS/mps_3_revised.csv", "./MPS/mps_4_revised.csv", "./MPS/mps_5.csv",
                 "./MPS/mps_6_revised.csv", "./MPS/mps_7_revised.csv",
                 "./MPS/mps_8.csv", "./MPS/mps_9.csv")
```


## Process all MPS files
```{r}
file_first <- TRUE

for(file in file_names){
  
  # Get the convocation number
  convocation <- as.numeric(str_extract(file, "\\d+"))
  print(convocation)
  
  # Download the MPS file for the convocation
  if (convocation %in% c(7,6,4,3)){
    df_mps_conv <- read.csv(file, sep=';', header=TRUE)
  } else {
    df_mps_conv <- read.csv(file, sep=',', header=TRUE, encoding = "UTF-8")
  }
  
  # 1. Change format of all variables to character
  columns_list <- colnames(df_mps_conv)
  for(name in columns_list){
    df_mps_conv[,name] = as.character(df_mps_conv[,name])
  }
  
  # 2. Substitute empty values and "n/a" with NA
  na_strings <- c("n/a", "")
  df_mps_conv <- df_mps_conv %>% replace_with_na_all(condition = ~.x %in% na_strings)
  
  
  # 3. Make sure that each observation has convocation number
  df_mps_conv$convocation <- convocation
  
  
  # 4. Process special cases of each convocation

  #### RADA 9
  if(convocation==9){
    df_mps_conv <- df_mps_conv %>%
                      # create full Ukr and Eng names
                      mutate(name_ukr = paste(surname, firstname, patronymic),
                             name_eng = paste(surname_en, firstname_en, patronymic_en)) %>%
      
                      # assistants columns
                      # Совсун Інна Романівна - wrong number of assistants
                      rename(assistants = assistants_count_all) %>%
      
                      # attendance columns
                      rename(plenary_attented = presentAuto_present,
                             plenary_missed = presentAuto_absent) %>%
      
                      # date columns
                      rename(date_resignation = resignation_date) %>%
      
                      mutate(date_oath = substr(date_oath,1,10),
                             date_resignation = substr(date_resignation,1,10),
                             birthday = substr(birthday,1,10)) %>%
      
                      mutate(date_oath = as.Date(date_oath, format="%Y-%m-%d"),
                             date_resignation = as.Date(date_resignation, format="%Y-%m-%d"),
                             birthday = as.Date(birthday, format="%Y-%m-%d")) %>%
      
                      # change numeric values to character
                      mutate(gender = recode(gender, !!!codes_gender)) %>%
                      mutate(type_elect = recode(type_elect, !!!codes_type_elect)) %>%
                      mutate(int_post = recode(int_post, !!!codes_int_post)) %>%
                      mutate(int_organization = recode(int_organization, !!!codes_int_organization)) %>%
                      mutate(party_id = recode(party_id, !!!codes_party_id)) %>%
                      mutate(region_id = recode(region_id, !!!codes_region_id)) %>%
      
      
                      mutate(committee = recode(committee, !!!codes_committee)) %>%
                      mutate(committee = ifelse(name_eng %in% no_committee_leftover_9,
                                                'Doesnt work in committee',
                                                committee)) %>%
                      mutate(committee = ifelse(name_ukr %in% rada_management_9,
                                                'Doesnt work in committee',
                                                committee)) %>%
      
                      mutate(committee_position = recode(committee_position, !!!codes_committee_position)) %>%
                      mutate(committee_position = ifelse(committee=="Doesnt work in committee",
                                                         NA,
                                                         committee_position)) %>%
      
                      mutate(faction = recode(faction, !!!codes_faction)) %>%
                      mutate(faction = ifelse(name_ukr %in% faction_non_affiliated_9, 'Non-affiliated',
                                              faction)) %>%
                      mutate(faction = ifelse(name_ukr %in% faction_trust_9, 'Trust',
                                              faction)) %>%
                      mutate(faction = ifelse(name_ukr %in% faction_sluha_9, 'Servant of the People',
                                              faction)) %>%
                      mutate(faction = ifelse(name_ukr %in% faction_voice_9, 'Voice',
                                              faction)) %>%
                      mutate(faction = ifelse(name_ukr %in% faction_batkivshchyna_9, 'Batkivshchyna',
                                              faction)) %>%
                      
                      # Rada management
                      mutate(faction = ifelse(name_ukr=="Стефанчук Руслан Олексійович",
                                              'Servant of the People',
                                              faction)) %>%
                      mutate(faction = ifelse(name_ukr=="Разумков Дмитро Олександрович",
                                              'Servant of the People',
                                              faction)) %>%
                      mutate(faction = ifelse(name_ukr=="Кондратюк Олена Костянтинівна",
                                              'Batkivshchyna',
                                              faction)) %>%

      
                      mutate(faction_position = recode(faction_position, !!!codes_faction_position)) %>%      
                      mutate(faction_position = ifelse(name_ukr %in% faction_heads_9,
                                                       "Chairman of the faction",
                                                       faction_position)) %>%
                      mutate(faction_position = ifelse(name_ukr %in% group_head_9,
                                                       "Chairman of the MPs group",
                                                       faction_position)) %>%
                      mutate(faction_position = ifelse((is.na(faction_position) & (faction=='Trust')),
                                                       "Member of the MPs group",
                                                       faction_position)) %>%
      
                      mutate(faction_position = ifelse((is.na(faction_position)),
                                                       "Member of the faction",
                                                       faction_position)) %>%
                      mutate(faction_position = ifelse(faction=='Non-affiliated',
                                                       NA,
                                                       faction_position)) %>%        
      
                      mutate(to_exec_judicial = ifelse(name_ukr %in% government_9, 'Yes', NA)) %>%

                      rename(elected = type_elect) %>%
                      rename(party = party_id) %>%
      
                      rename(ID_old = rada_id) %>%
                      rename(ID_9 = id) %>%
      
                      # delete unnecessary columns
                      select(-c(surname, firstname, patronymic,
                                surname_en, firstname_en, patronymic_en,
                                assistants_count_2, assistants_count_3, assistants_count_4))
    
    rm(codes_committee, codes_committee_position, codes_faction, codes_faction_position,
       codes_gender, codes_int_organization, codes_int_post, codes_party_id, codes_region_id,
       codes_type_elect, faction_heads_9, group_head_9, government_9, faction_non_affiliated_9,
       faction_trust_9, col_with_codes, no_committee_leftover_9, faction_sluha_9, faction_voice_9,
       faction_batkivshchyna_9, rada_management_9)
    
  } else {
    
    df_mps_conv <- df_mps_conv %>%
                      mutate(date_oath = as.Date(date_oath, format="%d.%m.%Y"),
                             date_resignation = as.Date(date_resignation, format="%d.%m.%Y")) %>%
                      
                      mutate(faction = ifelse(name_ukr %in% institutions,
                                              "Institution",
                                              faction))

    
    #### RADA 8
    if (convocation==8){
    
    df_mps_conv <- df_mps_conv %>%
      
                      rename(ID_old = X.U.FEFF.id) %>%
      
                      mutate(birthday = as.Date(birthday, format="%d.%m.%Y")) %>%
    
                      # FACTION
                      mutate(faction = ifelse(name_ukr %in% faction_non_affiliated_8, 'non-affiliated',
                                              faction)) %>%
                      mutate(faction = ifelse(name_ukr %in% faction_peoples_will_8, "Group \"Volia narodu\"",
                                              faction)) %>%
                      mutate(faction = ifelse(name_ukr %in% faction_samopomich_8,
                                              "\"Obyednannya \"Samopomich\"",
                                              faction)) %>%
                      mutate(faction = ifelse(name_ukr %in% faction_peoples_front_8, "\"Narodnyi Front\"",
                                              faction)) %>%
                      mutate(faction = ifelse(name_ukr %in% faction_poroshenko_8, "Petro Poroshenko Block",
                                              faction)) %>%
                      mutate(faction = ifelse(name_ukr %in% faction_radical_8,
                                              "Radical Party of Oleg Lyashko" ,
                                              faction)) %>%
                      mutate(faction = ifelse(name_ukr %in% faction_opposition_block_8,
                                              "Opposition Bloc",
                                              faction)) %>%
                      mutate(faction = ifelse(name_ukr %in% group_resurection_8,
                                              "Group \"Vidrodzhennia\"",
                                              faction)) %>%
                      mutate(faction = ifelse(name_ukr %in% institutions,
                                              "Institution",
                                              faction)) %>%
      
                      # Rada management
                      mutate(faction = ifelse(name_ukr=="Гройсман Володимир Борисович",
                                              'Petro Poroshenko Block',
                                              faction)) %>%
                      mutate(faction = ifelse(name_ukr=="Парубій Андрій Володимирович",
                                              "\"Narodnyi Front\"",
                                              faction)) %>%
                      mutate(faction = ifelse(name_ukr=='Геращенко Ірина Володимирівна',
                                              'Petro Poroshenko Block',
                                              faction)) %>%      
                      mutate(faction = ifelse(name_ukr=='Сироїд Оксана Іванівна',
                                              "\"Obyednannya \"Samopomich\"",
                                              faction)) %>%        
      
      
                      # FACTION POSITION
                      mutate(faction_position = ifelse(name_ukr %in%
                                            c('Гройсман Володимир Борисович','Парубій Андрій Володимирович'),
                                            "Chairman of the Verkhovna Rada" ,
                                            NA)) %>%
                      mutate(faction_position = ifelse(name_ukr == 'Геращенко Ірина Володимирівна',
                                            "First deputy chairman of the Verkhovna Rada",
                                            faction_position)) %>%      
                      mutate(faction_position = ifelse(name_ukr == 'Сироїд Оксана Іванівна',
                                            "Deputy chairman of the Verkhovna Rada",
                                            faction_position)) %>%
      
                      mutate(faction_position = ifelse(name_ukr %in% group_heads_8,
                                            "Chairman of the MPs group",
                                            faction_position)) %>%
                      mutate(faction_position = ifelse(name_ukr %in% group_co_heads_8,
                                            "Co-chair of the MPs group",
                                            faction_position)) %>%
                      mutate(faction_position = ifelse(name_ukr %in% faction_heads_8,
                                            "Chairman of the faction",
                                            faction_position)) %>%
                      mutate(faction_position = ifelse(is.na(faction_position) &
                                                       (faction=="Group \"Vidrodzhennia\"" |
                                                        faction=="Group \"Volia narodu\""),
                                            "Member of the MPs group",
                                            faction_position)) %>%
      
                      mutate(faction_position = ifelse(is.na(faction_position),
                                            "Member of the faction",
                                            faction_position)) %>%        
                      mutate(faction_position = ifelse(faction=='non-affiliated' | faction=='Institution',
                                            NA,
                                            faction_position)) %>%
      
                      mutate(to_exec_judicial = ifelse(name_ukr %in% government_8, 'Yes', NA))
    
    rm(rada_management_8, government_8, faction_heads_8, group_co_heads_8, group_heads_8,
       group_resurection_8, faction_opposition_block_8, 
       faction_non_affiliated_8, faction_peoples_will_8, faction_samopomich_8, faction_peoples_front_8,
       faction_poroshenko_8, faction_radical_8)
    
    
    #### RADA 7
    } else if (convocation==7) {
      
      df_mps_conv <- df_mps_conv %>%
        
                      rename(ID_old = id) %>%
      
                      # Rada management
                      mutate(faction = ifelse(name_ukr=='Рибак Володимир Васильович',
                                              'Party of Regions',
                                              faction)) %>%
                      mutate(faction = ifelse(name_ukr=='Турчинов Олександр Валентинович',
                                              "Batkivshchyna",
                                              faction)) %>%
                      mutate(faction = ifelse(name_ukr=='Калєтнік Ігор Григорович',
                                              'Communist Party',
                                              faction)) %>%      
                      mutate(faction = ifelse(name_ukr=='Кошулинський Руслан Володимирович',
                                              'Svoboda',
                                              faction)) %>%     
      
                      # FACTION POSITION
                      mutate(faction_position = ifelse(name_ukr %in%
                                            c('Рибак Володимир Васильович','Турчинов Олександр Валентинович'),
                                            "Chairman of the Verkhovna Rada" ,
                                            NA)) %>%
                      mutate(faction_position = ifelse(name_ukr == 'Калєтнік Ігор Григорович',
                                            "First deputy chairman of the Verkhovna Rada",
                                            faction_position)) %>%      
                      mutate(faction_position = ifelse(name_ukr == 'Кошулинський Руслан Володимирович',
                                            "Deputy chairman of the Verkhovna Rada",
                                            faction_position)) %>%
      
                      mutate(faction_position = ifelse(name_ukr %in% group_heads_7,
                                            "Chairman of the MPs group",
                                            faction_position)) %>%
                      mutate(faction_position = ifelse(name_ukr %in% group_representatives_7,
                                            "Representative of the MPs group",
                                            faction_position)) %>%
                      mutate(faction_position = ifelse(name_ukr %in% faction_heads_7,
                                            "Chairman of the faction",
                                            faction_position)) %>%
                      mutate(faction_position = ifelse(is.na(faction_position) &
                                                       (faction=="Economic Development" |
                                                        faction=="European Ukraine" |
                                                        faction=="Peace and Stability"),
                                            "Member of the MPs group",
                                            faction_position)) %>%
                      mutate(faction_position = ifelse(is.na(faction_position),
                                            "Member of the faction",
                                            faction_position)) %>%        
                      mutate(faction_position = ifelse(faction=='Non-affiliated' | faction=='Institution',
                                            NA,
                                            faction_position)) %>%
      
                      mutate(to_exec_judicial = ifelse(name_ukr %in% government_7, 'Yes', NA))
    
    rm(rada_management_7, government_7, faction_heads_7, group_heads_7, group_representatives_7)      
 
    
    #### RADA 6
    } else if (convocation==6) {

      df_mps_conv <- df_mps_conv %>%
        
                      rename(ID_old = id) %>%
      
                      # Rada management
                      mutate(faction = ifelse(name_ukr=='Яценюк Арсеній Петрович',
                                              'Nasha Ukraina',
                                              faction)) %>%
                      mutate(faction = ifelse(name_ukr=='Литвин Володимир Михайлович',
                                              "Bloc Lytvyna",
                                              faction)) %>%
                      mutate(faction = ifelse(name_ukr=='Лавринович Олександр Володимирович',
                                              'Party of Regions',
                                              faction)) %>%      
                      mutate(faction = ifelse(name_ukr=='Мартинюк Адам Іванович',
                                              'Communist Party',
                                              faction)) %>%    
                      mutate(faction = ifelse(name_ukr=='Томенко Микола Володимирович',
                                              'Batkivshchyna',
                                              faction)) %>%          
      
                      # FACTION POSITION
                      mutate(faction_position = ifelse(name_ukr %in%
                                            c('Яценюк Арсеній Петрович', 'Литвин Володимир Михайлович'),
                                            "Chairman of the Verkhovna Rada" ,
                                            NA)) %>%
                      mutate(faction_position = ifelse(name_ukr %in% c('Лавринович Олександр Володимирович',
                                                                       'Мартинюк Адам Іванович'),
                                            "First deputy chairman of the Verkhovna Rada",
                                            faction_position)) %>%      
                      mutate(faction_position = ifelse(name_ukr == 'Томенко Микола Володимирович',
                                            "Deputy chairman of the Verkhovna Rada",
                                            faction_position)) %>%
      
                      mutate(faction_position = ifelse(name_ukr %in% group_heads_6,
                                            "Chairman of the MPs group",
                                            faction_position)) %>%
                      mutate(faction_position = ifelse(name_ukr %in% faction_heads_6,
                                            "Chairman of the faction",
                                            faction_position)) %>%
                      mutate(faction_position = ifelse(is.na(faction_position) &
                                                       faction=="For the future",
                                            "Member of the MPs group",
                                            faction_position)) %>%
                      mutate(faction_position = ifelse(is.na(faction_position),
                                            "Member of the faction",
                                            faction_position)) %>%        
                      mutate(faction_position = ifelse(faction=='Non-affiliated' | faction=='Institution',
                                            NA,
                                            faction_position)) %>%
      
                      mutate(to_exec_judicial = ifelse(name_ukr %in% government_6, 'Yes', to_exec_judicial))
    
    rm(rada_management_6, government_6, faction_heads_6, group_heads_6)
    
 
    #### RADA 5   
    } else if (convocation==5) {
      
      df_mps_conv <- df_mps_conv %>%
        
                      rename(ID_old = X.U.FEFF.id) %>%
      
                      # Rada management
                      mutate(faction = ifelse(name_ukr=='Мороз Олександр Олександрович',
                                              'Socialist Party of Ukraine',
                                              faction)) %>%
                      mutate(faction = ifelse(name_ukr=='Мартинюк Адам Іванович',
                                              'Communist Party of Ukraine',
                                              faction)) %>%    
                      mutate(faction = ifelse(name_ukr=='Томенко Микола Володимирович',
                                              'Yuliia Tymoshenko Bloсk',
                                              faction)) %>%    
        
                      # FACTION POSITION
                      mutate(faction_position = ifelse(name_ukr == 'Мороз Олександр Олександрович',
                                            "Chairman of the Verkhovna Rada" ,
                                            NA)) %>%
                      mutate(faction_position = ifelse(name_ukr == 'Мартинюк Адам Іванович',
                                            "First deputy chairman of the Verkhovna Rada",
                                            faction_position)) %>%      
                      mutate(faction_position = ifelse(name_ukr == 'Томенко Микола Володимирович',
                                            "Deputy chairman of the Verkhovna Rada",
                                            faction_position)) %>%
      
                      mutate(faction_position = ifelse(name_ukr %in% faction_heads_5,
                                            "Chairman of the faction",
                                            faction_position)) %>%
                      mutate(faction_position = ifelse(is.na(faction_position),
                                            "Member of the faction",
                                            faction_position)) %>%        
                      mutate(faction_position = ifelse(faction=='Institution',
                                            NA,
                                            faction_position)) %>%
      
                      mutate(to_exec_judicial = ifelse(name_ukr %in% government_5, 'Yes', NA))
    
    rm(rada_management_5, government_5, faction_heads_5)  
    
    
    #### RADA 4
    } else if (convocation==4) {
      
      df_mps_conv <- df_mps_conv %>%
        
                      rename(ID_old = id) %>%
      
                      # Rada management
                      mutate(faction = ifelse(name_ukr=='Литвин Володимир Михайлович',
                                              'Narodnyy blok Lytvyna',
                                              faction)) %>%
                      mutate(faction = ifelse(name_ukr=='Васильєв Геннадій Андрійович',
                                              'Non-affiliated',
                                              faction)) %>%            
                      mutate(faction = ifelse(name_ukr=='Мартинюк Адам Іванович',
                                              'Communist Party of Ukraine',
                                              faction)) %>%    
                      mutate(faction = ifelse(name_ukr=='Зінченко Олександр Олексійович',
                                              'SDPU(o)',
                                              faction)) %>%    
        
                      # FACTION POSITION
                      mutate(faction_position = ifelse(name_ukr == 'Литвин Володимир Михайлович',
                                            "Chairman of the Verkhovna Rada" ,
                                            NA)) %>%
                      mutate(faction_position = ifelse(name_ukr %in% c('Васильєв Геннадій Андрійович',
                                                                       'Мартинюк Адам Іванович'),
                                            "First deputy chairman of the Verkhovna Rada",
                                            faction_position)) %>%      
                      mutate(faction_position = ifelse(name_ukr == 'Зінченко Олександр Олексійович',
                                            "Deputy chairman of the Verkhovna Rada",
                                            faction_position)) %>%
      
                      mutate(faction_position = ifelse(name_ukr %in% faction_representatives_4,
                                            "Representative of the faction",
                                            faction_position)) %>%
                      mutate(faction_position = ifelse(name_ukr %in% group_representative_4,
                                            "Representative of the MPs group",
                                            faction_position)) %>%      
                      mutate(faction_position = ifelse(name_ukr %in% group_head_4,
                                            "Chairman of the MPs group",
                                            faction_position)) %>%        
        
                      mutate(faction_position = ifelse(is.na(faction_position) &
                                                       faction=='Narodnyy blok Lytvyna',
                                            "Member of the MPs group",
                                            faction_position)) %>%  
                      mutate(faction_position = ifelse(is.na(faction_position),
                                            "Member of the faction",
                                            faction_position)) %>%        
                      mutate(faction_position = ifelse(faction=='Institution',
                                            NA,
                                            faction_position)) 
    
    rm(rada_management_4, group_head_4, faction_representatives_4, group_representative_4)
    
    
    #### RADA 4
    } else if (convocation==3) {
      
      df_mps_conv <- df_mps_conv %>%
        
                      rename(ID_old = id) %>%
      
                      # Rada management
                      mutate(faction = ifelse(name_ukr=='Ткаченко Олександр Миколайович',
                                              'Non-affiliated',
                                              faction)) %>%
                      mutate(faction = ifelse(name_ukr=='Плющ Іван Степанович',
                                              'Narodno Demokratychna partiya',
                                              faction)) %>%            
                      mutate(faction = ifelse(name_ukr=='Мартинюк Адам Іванович',
                                              'Communist Party of Ukraine',
                                              faction)) %>%    
                      mutate(faction = ifelse(name_ukr=='Медведчук Віктор Володимирович',
                                              'SDPU(o)',
                                              faction)) %>%    
                      mutate(faction = ifelse(name_ukr=='Гавриш Степан Богданович',
                                              'SDPU(o)',
                                              faction)) %>%   
        
                      # FACTION POSITION
                      mutate(faction_position = ifelse(name_ukr %in% c('Ткаченко Олександр Миколайович',
                                                                       'Плющ Іван Степанович'),
                                            "Chairman of the Verkhovna Rada" ,
                                            NA)) %>%
                      mutate(faction_position = ifelse(name_ukr %in% c('Мартинюк Адам Іванович',
                                                                       'Медведчук Віктор Володимирович'),
                                            "First deputy chairman of the Verkhovna Rada",
                                            faction_position)) %>%      
                      mutate(faction_position = ifelse(name_ukr == 'Гавриш Степан Богданович',
                                            "Deputy chairman of the Verkhovna Rada",
                                            faction_position))
    
    rm(rada_management_3)      
    }


  }



  # 4. Append new data
  if(file_first){
      df_mps <- df_mps_conv
      file_first <- FALSE
  } else {
      df_mps <- bind_rows(df_mps, df_mps_conv)
  }

  print('######################')
  
}
rm(convocation, institutions, df_mps_conv, file, file_first, file_names, na_strings,
   name, columns_list, mps_codes)

# write.csv(df_mps,"./MPS/mps_combined.csv", row.names = FALSE)
```


## Cleaning the merged file
```{r}
### Unify spelling of Partys and Factions across convocations
partys <- read.csv('./MPS/values_party.csv', sep=';', header=TRUE)
factions <- read.csv('./MPS/values_faction.csv', sep=';', header=TRUE)

faction_codes <- as.character(factions$faction_new)
names(faction_codes) <- as.character(factions$faction_original)

party_codes <- as.character(partys$party_new)
names(party_codes) <- as.character(partys$party_original)

df_mps <- df_mps %>%
            mutate(faction = recode(faction, !!!faction_codes)) %>%
            mutate(party = recode(party, !!!party_codes))

rm(partys, factions, faction_codes, party_codes)
```


```{r}
### Unify Ukrainian names

names <- read.csv('./MPS/values_name_ukr.csv', sep=';', header=TRUE)

####### UA
names_codes <- as.character(names$name_new)
names(names_codes) <- as.character(names$name_original)

df_mps <- df_mps %>%
            mutate(name_ukr = recode(name_ukr, !!!names_codes))

rm(names, names_codes)
```


```{r}
### Unify transliterations of Ukrainian names

names <- read.csv('./MPS/values_name_eng.csv', sep=';', header=TRUE)

names_codes <- as.character(names$name_new)
names(names_codes) <- as.character(names$name_original)

df_mps <- df_mps %>%
            mutate(name_eng = recode(name_eng, !!!names_codes))

rm(names, names_codes)
```


```{r}
### Remove ' and " sign from English names
df_mps$name_eng <- gsub("'", "", df_mps$name_eng)
df_mps$name_eng <- gsub('"', "", df_mps$name_eng)

### Father and son have the same name
df_mps <- df_mps %>%
            mutate(name_ukr = ifelse(name_ukr=='Омельченко Олександр Олександрович' & convocation==5,
                                     'Омельченко Олександр Олександрович (син)',
                                     name_ukr)) %>%
            mutate(name_eng = ifelse(name_ukr=='Омельченко Олександр Олександрович (син)',
                                     'Omelchenko Oleksandr Oleksandrovych (son)',
                                     name_eng))

### Difficult case with Eng name
df_mps <- df_mps %>%
            mutate(name_eng = ifelse(name_ukr=='Танюк Леонід Степанович',
                                     'Tanyuk Leonid Stepanovych',
                                     name_eng))
### Missing Eng name
df_mps <- df_mps %>%
            mutate(name_eng = ifelse(name_ukr=='Бордюг Інна Леонідівна',
                                     'Bordyuh Inna Leonidivna',
                                     name_eng))
df_mps <- df_mps %>%
            mutate(gender = ifelse(name_ukr=='Бордюг Інна Леонідівна', 'female', gender))

### Strange symbol
df_mps <- df_mps %>%
            mutate(name_eng = ifelse(name_eng=='Raz·honyayev Mykhaylo Vasylovych',
                                     'Razhonyayev Mykhaylo Vasylovych',
                                     name_eng))


### Assign unique ID
df_mps$ID_new <- as.numeric(as.factor(df_mps$name_ukr))

### Reorder columns
df_mps <- df_mps[, c(ncol(df_mps), seq(1,ncol(df_mps)-1))]


# both "Tryhubenko Serhiy Mykolayovych" and "Turchynov Oleksandr Valentynovych" had *facebook* "https://www.facebook.com/sergiy.trygubenko." We changed the *facebook* of "Turchynov Oleksandr Valentynovych" to NA.
df_mps[df_mps$name_eng=='Turchynov Oleksandr Valentynovych','facebook'] <- NA
```


## Assign each variable an appropriate format
```{r}

# ID_new and convocation are already numeric
# date_oath, date_resignation and birthday are already date
to_numeric <- c('ID_old', 'age', 'num_in_party', 'assistants', 'district_num', 
                'plenary_attented', 'plenary_missed', 'ID_9')
to_factor <- c('gender','party', 'faction', 'elected', 'education', 'specialization',
               'committee', 'faction_position', 'to_exec_judicial', 'committee_position',
               'int_organization', 'int_post', 'region_id')


for (col in colnames(df_mps)) {
  
  
  if(col %in% to_numeric){
    print(col)
    df_mps[,col] = as.numeric(df_mps[[col]])
    
  } else if(col %in% to_factor) {
    print(col)
    df_mps[,col] = as.factor(df_mps[[col]])
  }
}

rm(to_numeric, to_factor, col)
```


## Save files
```{r}
write.csv(df_mps,"./mps_combined.csv", row.names = FALSE)
saveRDS(df_mps, file = "./mps_combined.rds")
```



